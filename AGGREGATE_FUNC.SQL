-- CONTINUING WITH THE LIFELINE_HOSPITAL DATABASE 
-- HERE IS THE CODE FOR LIFELINE DATABASE(INCLUDES ALL THE CHANGES I MADE UNDER THE TASK2):

CREATE DATABASE LIFELINE_HOSPITAL;
USE LIFELINE_HOSPITAL;

CREATE TABLE PATIENT(P_ID VARCHAR(10) PRIMARY KEY , P_NAME Varchar(30), DISEASE varchar(50),GENDER varchar(1),DOB date , MOB_NO varchar(10), AGE int, ADDRESS  varchar(200));
CREATE TABLE EMPLOYEE(E_ID VARCHAR(10) PRIMARY KEY, E_NAME Varchar(30),DESIGNATION varchar(6), SALARY INT, DEPT VARCHAR(100), MOB_NO varchar(10),ADDRESS varchar(200));
CREATE TABLE DOCTOR(EID VARCHAR(10),FOREIGN KEY (EID) REFERENCES EMPLOYEE (E_ID), QUALIFICATION VARCHAR(20));
CREATE TABLE NURSE(EID VARCHAR(10), FOREIGN KEY (EID) REFERENCES EMPLOYEE (E_ID),SHIFT VARCHAR(10),EXPERIENCE_YEARS float(3,1));
CREATE TABLE ROOMS(R_ID VARCHAR(10) PRIMARY KEY,R_TYPE VARCHAR(100), CAPACITY INT3, AVAILABILITY INT2,DEPT VARCHAR(100) ,FLOOR_NO VARCHAR(100) );
CREATE TABLE TEST_REPORT (TR_ID VARCHAR(10),PID VARCHAR(10),FOREIGN KEY (PID) REFERENCES patient (P_ID), RID VARCHAR(10),FOREIGN KEY (RID) REFERENCES rooms (R_ID),TEST_TYPE varchar(10),RESULT VARCHAR(10),T_DATE date,REMARKS varchar(1000) );
CREATE TABLE BILLS(B_ID varchar(10) primary key, PID VARCHAR(10) ,FOREIGN KEY (PID) REFERENCES patient (P_ID),BillDate date,	TotalAmount float(7,2),	PaidAmount float(7,2),	DueAmount float(7,2),PaymentStatus varchar(10));

-- INSERTION
-- INSERTION OF RECORDS IN PATIENT TABLE:
INSERT INTO PATIENT (P_ID, P_NAME, DISEASE, GENDER, DOB, MOB_NO, AGE, ADDRESS) VALUES
('P001', 'Amanpreet Kaur', 'Fever', 'F', '1992-01-15', 9876541230, 31, '101 Model Town, Ludhiana, Punjab'),
('P002', 'Rajesh Kumar', 'Cold', 'M', '1985-07-20', 9876541231, 38, '502 Civil Lines, Amritsar, Punjab'),
('P003', 'Neha Sharma', 'Hypertension', 'F', '1990-05-10', 9876541232, 33, NULL),
('P004', 'Ankit Yadav', 'Migraine', 'M', '1995-03-25', 9876541233, 28, '204 Gomti Nagar, Lucknow, Uttar Pradesh'),
('P005', 'Priya Singh', 'Diabetes', 'F', '1988-09-05', 9876541234, 35, NULL);


-- INSERTION OF RECORDS IN EMPLOYEE TABLE:
INSERT INTO EMPLOYEE (E_ID, E_NAME, DESIGNATION, SALARY, DEPT, MOB_NO, ADDRESS) VALUES
('E001', 'Dr. Manpreet Singh', 'Doctor', 80000, 'General Medicine', 9876543215, '25 Golden Temple Road, Amritsar, Punjab'),
('E002', 'Dr. Arjun Sharma', 'Doctor', 85000, 'Surgery', 9876543216, '78 Janakpuri, New Delhi, Delhi'),
('E003', 'Dr. Kavita Verma', 'Doctor', 90000, 'Cardiology', 9876543217, '45 Chowk Area, Varanasi, Uttar Pradesh'),
('E004', 'Nurse Priya Das', 'Nurse', 45000, 'General Medicine', 9876543218, '62 Boring Road, Patna, Bihar'),
('E005', 'Nurse Rakesh Kumar', 'Nurse', 46000, 'Orthopedics', 9876543219, '34 Phase 1, Mohali, Punjab');


-- INSERTION OF RECORDS IN DOCTOR TABLE:
INSERT INTO DOCTOR (EID, QUALIFICATION) VALUES
('E001', 'MBBS, MD'),
('E002', 'MBBS, MS'),
('E003', 'MBBS, DM');

-- INSERTION OF RECORDS IN NURSE TABLE:
INSERT INTO NURSE (EID, SHIFT, EXPERIENCE_YEARS) VALUES
('E004', 'Day', 5.0),
('E005', 'Night', 3.5);

-- INSERTION OF RECORDS IN ROOMS TABLE:
INSERT INTO ROOMS (R_ID, R_TYPE, CAPACITY, AVAILABILITY, DEPT, FLOOR_NO) VALUES
('R101', 'General', 5, 3, 'General Medicine', '1'),
('R102', 'Private', 1, 1, 'Surgery', '2'),
('R103', 'ICU', 2, NULL, 'Cardiology', '3'),
('R104', 'Semi-Private', 3, 2, 'Neurology', '4');

-- INSERTION OF RECORDS IN TEST_REPORT TABLE:
INSERT INTO TEST_REPORT (TR_ID, PID, RID, TEST_TYPE, RESULT, T_DATE, REMARKS) VALUES
('TR001', 'P001', 'R101', 'Blood Test', 'Normal', '2025-06-20', 'Routine check-up'),
('TR002', 'P002', 'R102', 'X-Ray', 'Fracture', '2019-06-21', 'Requires surgery'),
('TR003', 'P003', 'R103', 'ECG', 'Abnormal', '2025-06-19', 'Further tests advised');

-- INSERTION OF RECORDS IN BILLS TABLE:
INSERT INTO BILLS (B_ID, PID, BillDate, TotalAmount, PaidAmount, DueAmount, PaymentStatus) VALUES
('B001', 'P001', '2025-06-20', 5000.00000, 5000.00000, 0.00000, 'Paid'),
('B002', 'P002', '2025-06-21', 12000.00000, 8000.00000, 4000.00000, 'Partial'),
('B003', 'P003', '2025-06-22', 7000.50000, 7000.50000, 0.00000, 'Paid'),
('B004', 'P004', '2025-06-23', 15000.00000, 10000.00000, 5000.00000, 'Partial'),
('B005', 'P005', '2025-06-24', 8500.75000, 8500.75000, 0.00000, 'Paid');


-- DUE TO FULL ROOMS ,i modified availability to ZERO by default:
ALTER TABLE ROOMS MODIFY AVAILABILITY INT DEFAULT 0;

-- PATIENTS WHOSE ADDRESS VALUE IS NULL RE HOMELESS ,SO THE HOSPITAL TEAM DECIDED TO CHARGE NO FEES TO THEM:
UPDATE BILLS SET  TotalAmount=0, PaidAmount=0, DueAmount=0,PaymentStatus='Paid' WHERE PID=(SELECT P_ID FROM PATIENT WHERE ADDRESS=NULL);

-- DATA OLDER THSN 5 YEARS MUST DELETED TO REMOVE THE AMBIGUITY OF RECORDS(HELPS TO CLEAN AD MAINTAIN DATA):
-- FOR EXECUTING THIS DELETE STATEMENT I HAVE TO DISABLE safe_update_mode AS IT PREVENTS THE DATA LOSS:
SET SQL_SAFE_UPDATES = 0;
DELETE FROM TEST_REPORT WHERE T_DATE < '2021-01-01';
-- NOW ON safe_update_mode TO ENSURE THAT ANY DATA LOSS CANNOT HAPPEN BY MISTAKE:
SET SQL_SAFE_UPDATES = 1;

-- ---------------------------------------------------
-- -------------------TASK 4--------------------------
-- ---------------------------------------------------
USE LIFELINE_HOSPITAL; -- (COMMENT IF EXECUTING TASK4 CODE  WITH ABOVE CODE) 

INSERT INTO PATIENT VALUES ('P006','Suresh kumar','Migraine','M','2004-03-07','9999999998',21,'Dhurkot,Barnala,Punjab');
INSERT INTO ROOMS VALUES('R105','General',5,2,'Surgery',1);

-- USING AVG FUNCTION:
-- AVERAGE AGE OF PATIENTS HAVING MIGRAINE:
SELECT AVG(AGE) AVERAGE_AGE FROM PATIENT WHERE DISEASE='MIGRAINE'; 

-- USING COUNT FUNCTION :
-- COUNT TOTAL NUMBER OF PATIENTS HAVING MIGRAINE:
SELECT COUNT(P_ID) FROM PATIENT WHERE DISEASE IN( 'Migraine', 'HyperTension');
-- TOTAL NUMBER OF DOCTORS IN LIFELINE_HOSPITAL:
SELECT COUNT(DESIGNATION) FROM EMPLOYEE WHERE DESIGNATION IN ('Doctor');

-- USING SUM FUNCTION:
-- SUM OF DUE AMOUNT OF PATIENTS:
SELECT SUM(DueAmount) FROM BILLS ;

-- USIG MAX AND MIN FUNCTION:
-- MAXIMUM SALARY OF DOCTOR IN LIFELINE HOSPITAL:
SELECT MAX(SALARY) FROM EMPLOYEE WHERE DESIGNATION IN('Doctor');
-- MINIMUM SALARY OF NURSE IN LIFELINE HOSPITAL:

-- USING GROUP BY :
-- CALCULATE THE NUMBER OF DISEASE OF DIFFERENT GENDERS: 
SELECT GENDER, COUNT(distinct(DISEASE)) FROM PATIENT GROUP BY GENDER;

-- USING HAVING:
-- MAXIMUM SALARY OF DOCTOR in SURGERY AND GENERAL MEDICINE DEPT
SELECT DISTINCT(DEPT),MAX(SALARY) FROM EMPLOYEE WHERE DESIGNATION ='Doctor' GROUP BY DEPT HAVING DEPT IN ('Surgery','General Medicine');


